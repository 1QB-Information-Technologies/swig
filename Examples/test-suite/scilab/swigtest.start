lines(0);
warning('off');
ilib_verbose(0);

// Get test name (used in swigtest.quit file)
[units, typ, names] = file(1);
swigtestname = strsubst(fileparts(names, "fname"), "_runme", "");

// Test build dir
testbuilddir = swigtestname + ".build";

// Does the library exists? If not then exit!
libname = "lib" + swigtestname + "lib" + getdynlibext();
if ~isfile(fullfile(testbuilddir, libname)) then
    mprintf("*** LIBRARY NOT FOUND: %s ***\n", "lib" + swigtestname + "lib" + getdynlibext());
    exit(1)
end

// Load library
try
    exec(fullfile(testbuilddir, "loader.sce"), -1);
catch
    mprintf("*** LOADER EXECUTION FAILED ***\n");
    exit(1)
end

// Module initialization
try
    moduleInit = sprintf("%s_Init()", swigtestname);
    ierr = execstr(moduleInit);
catch
    mprintf("*** MODULE INIT FAILED ***\n");
    exit(ierr)
end

// Error management function
function swigtesterror()
    mprintf("*** TEST FAILED ***\n")
    exit(1)
endfunction
